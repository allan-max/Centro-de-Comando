<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Centro de Comando - Tempo Real</title>
<style>
  * { box-sizing: border-box; }
  body { background-color: #0d1117; color: #c9d1d9; font-family: 'Courier New', Courier, monospace; margin: 0; padding: 15px; display: flex; flex-direction: column; min-height: 100vh; }
  
  .header-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
  h1 { color: #58a6ff; margin: 0; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; }
  
  /* Bot√£o de Rein√≠cio */
  .btn-reiniciar { background-color: #238636; color: #ffffff; border: 1px solid rgba(240, 246, 252, 0.1); padding: 8px 16px; font-weight: bold; border-radius: 6px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 8px; font-family: inherit; }
  .btn-reiniciar:hover { background-color: #2ea043; }
  .btn-reiniciar:active { transform: scale(0.95); }

  /* Grid 2x2 para os terminais */
  .container { display: flex; flex-wrap: wrap; gap: 20px; flex: 1; }
  .terminal { flex: 1 1 calc(50% - 20px); background-color: #010409; border: 1px solid #30363d; border-radius: 6px; display: flex; flex-direction: column; min-height: 300px; max-height: 45vh; }
  
  .terminal-header { background-color: #161b22; padding: 10px; text-align: center; font-weight: bold; border-bottom: 1px solid #30363d; color: #8b949e; font-size: 0.9rem; }
  .terminal-body { flex: 1; padding: 10px; overflow-y: auto; font-size: 0.85rem; line-height: 1.4; white-space: pre-wrap; word-break: break-word; }
  
  .log-linha { margin-bottom: 4px; border-bottom: 1px dashed #30363d; padding-bottom: 4px; }
  .tag-info { color: #3fb950; font-weight: bold; }
  .tag-erro { color: #f85149; font-weight: bold; }
  .tag-data { color: #8b949e; }
  .tag-alerta { color: #d29922; font-weight: bold; }

  /* Scrollbar customizada */
  ::-webkit-scrollbar { width: 8px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background-color: #6e7681; border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }
  ::-webkit-scrollbar-thumb:hover { background-color: #8b949e; }

  @media (max-width: 900px) { .terminal { flex: 1 1 100%; max-height: 350px; } .header-container { flex-direction: column; justify-content: center; text-align: center; } }
</style>
</head>
<body>
  <div class="header-container">
      <h1>üåê Centro de Comando</h1>
      <button class="btn-reiniciar" onclick="enviarComandoReiniciar()">
          üöÄ REINICIAR DEPLOY
      </button>
  </div>

  <div class="container">
    <div class="terminal"><div class="terminal-header">ü§ñ Bot WhatsApp (Node)</div><div class="terminal-body" id="log-node"></div></div>
    <div class="terminal"><div class="terminal-header">üêç API Datasheet (Python)</div><div class="terminal-body" id="log-python"></div></div>
    <div class="terminal"><div class="terminal-header">‚öôÔ∏è HSE (.NET)</div><div class="terminal-body" id="log-hse"></div></div>
    <div class="terminal"><div class="terminal-header">üö® Deploy & Webhook</div><div class="terminal-body" id="log-deploy"></div></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
      const socket = io();

      function adicionarLog(containerId, texto) {
          const container = document.getElementById(containerId);
          const divLinha = document.createElement('div');
          divLinha.className = 'log-linha';

          let htmlTexto = texto
              .replace(/\[(.*?)\]/, '<span class="tag-data">[$1]</span>')
              .replace(/INFO:/, '<span class="tag-info">INFO:</span>')
              .replace(/ERRO:/, '<span class="tag-erro">ERRO:</span>')
              .replace(/üö®|üöÄ|üßπ/g, '<span class="tag-alerta">$&</span>'); 

          divLinha.innerHTML = htmlTexto;
          container.appendChild(divLinha);
          container.scrollTop = container.scrollHeight;
      }

      socket.on('novo_log_node', (linha) => adicionarLog('log-node', linha));
      socket.on('novo_log_python', (linha) => adicionarLog('log-python', linha));
      socket.on('novo_console-log', (linha) => adicionarLog('log-hse', linha));
      socket.on('novo_log_deploy', (linha) => adicionarLog('log-deploy', linha));

      // Fun√ß√£o acionada pelo Bot√£o
      function enviarComandoReiniciar() {
          const senha = prompt("Digite a senha de seguran√ßa para reiniciar os servidores:");
          if(senha) {
              socket.emit('solicitar_reiniciar', { chave: senha });
              alert("Comando enviado! Acompanhe o log do Deploy.");
          }
      }
  </script>
</body>
</html>